<!DOCTYPE html>
<html>
<body>
<h3>Hybrid WebRTC (Watch) + EC2 (Process)</h3>
<video id="video" autoplay playsinline width="480"></video>

<script>
const EC2_UPLOAD = "http://13.232.18.180:8000/upload"; // change if needed
const video = document.getElementById("video");

async function start() {
  const stream = await navigator.mediaDevices.getUserMedia({ video: true });
  video.srcObject = stream;

  // Canvas to grab frames
  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");

  setInterval(async () => {
    canvas.width = 320;
    canvas.height = 240;
    ctx.drawImage(video, 0, 0, 320, 240);

    const blob = await new Promise(r =>
      canvas.toBlob(r, "image/jpeg", 0.5)
    );

    const form = new FormData();
    form.append("file", blob);

    fetch(EC2_UPLOAD, { method: "POST", body: form })
      .catch(() => {});
  }, 120); // ~8 FPS to EC2
}

start();
</script>
</body>
</html>
